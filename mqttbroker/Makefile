# Makefile
#
# Generated by phxrpc_pb2server from mqttbroker.proto
#
#

include /phx/phxrpc/phxrpc.mk

LDFLAGS := -L$(PHXRPC_ROOT)/lib -lphxrpc $(LDFLAGS)

LIB_MQTT_OBJS = mqtt/mqtt_msg.o mqtt/mqtt_msg_handler.o mqtt/mqtt_protocol.o \
		mqtt/mqtt_msg_handler_factory.o mqtt/mqtt_session.o mqtt/mqtt_packet_id.o

SVR_OBJS = mqttbroker.pb.o \
		event_loop_server_config.o \
		event_loop_server.o \
		server_mgr.o \
		mqttbroker_service_impl.o \
		phxrpc_mqttbroker_service.o \
		phxrpc_mqttbroker_dispatcher.o \
		mqttbroker_server_config.o \
		mqttbroker_main.o

all: mqttbroker_main

mqttbroker_main: $(SVR_OBJS) $(LIB_MQTT_OBJS)
	$(LINKER) $^ $(LDFLAGS) -o $@

########## message ##########

mqttbroker.pb.cc: mqttbroker.pb.h

mqttbroker.pb.h: mqttbroker.proto
	$(PROTOBUF_ROOT)/bin/protoc -I$(PROTOBUF_ROOT)/include --cpp_out=. -I$(PHXRPC_ROOT) -I. $^

########## service ##########

phxrpc_mqttbroker_service.cpp: phxrpc_mqttbroker_service.h
phxrpc_mqttbroker_service.o: phxrpc_mqttbroker_service.h
mqttbroker_service_impl.cpp: phxrpc_mqttbroker_service.h
mqttbroker_service_impl.o: phxrpc_mqttbroker_service.h
phxrpc_mqttbroker_dispatcher.cpp: phxrpc_mqttbroker_service.h
phxrpc_mqttbroker_dispatcher.o: phxrpc_mqttbroker_service.h

phxrpc_mqttbroker_service.h: mqttbroker.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2service $(PBFLAGS) -f $^ -d . -u

clean:
	@($(RM) $(TARGETS))
	@($(RM) *.o)
	@($(RM) phxrpc_*)
	@($(RM) *.pb.*)
	@($(RM) mqtt/*.o)

